---
title: "Sample Code"
output: 
  html_document:
    toc: true
    toc_float: true
---

## Description of Data

The New York City Department of Health and Mental Hygiene (DOHMH) conducts unannounced restaurant inspections on an annual basis in order to check for compliance with policies on food handling, food temperature, personal hygiene of restaurant workers, and vermin control. Regulation violations are each worth a pre-specified number of points, which are totaled at the end of the inspection. Scores are converted into grades, where a lower score earns a higher grade.

Each violation falls into one of three categories:

A public health hazard, such as failing to store food at an appropriate temperature, results in a minimum score of 7

A critical violation, such as improperly washing raw vegetables prior to serving, results in a minimum score of 5

A general violation, such as improperly sanitizing cookware, results in a minimum score of 2

Additional points can then be assigned based on the severity of the violation, ranging from 1-5, at the discretion of the inspector.

Data on restaurant inspection results are publicly available at NYC Open Data and are updated daily. The specific data to be used in this class, linked to at the top of this page, was accessed in October 2017 using the code below.

## Sample Code

The below code produces the plots for the _Dashboard_ tab above.

```{r}
library(tidyverse)
library(viridis)
library(p8105.datasets)
library(plotly)
data(rest_inspec)
```

```{r}
rest_clean = 
  mutate(rest_inspec, grade_date = as.character(grade_date)) %>% 
  separate(col = grade_date, into = c("year", "month", "day"), sep="-") %>% 
  select(-building, -camis, -street, -zipcode, -phone, -record_date, -violation_code) %>% 
  drop_na(grade, year) %>%
  filter(grade == "A" | grade == "B" | grade == "C", boro != "Missing", year != "2012")


rest_clean %>% 
  mutate(
    is_a = (grade == "A")
  ) %>% 
  group_by(boro, year) %>% 
  summarize(
    proportion_a = sum(is_a)/n()
  ) %>% plot_ly(x = ~year, y = ~proportion_a, type = "scatter", mode = "lines+markers",
    color = ~boro, alpha = 0.5)
```

```{r}
rest_clean %>% 
  group_by(grade, boro) %>% 
  summarize(
    n = n()
  ) %>% 
  plot_ly(x = ~boro, y = ~n, type = "bar",
          color = ~grade, alpha = 0.5)
```

```{r}
rest_clean %>% 
  plot_ly(x = ~boro, y = ~score, type = "violin")
```
