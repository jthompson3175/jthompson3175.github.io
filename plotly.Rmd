---
title: "NYC Restaurant Inspections"
output: 
  html_document:
    toc: true
    toc_float: true
---

## Description of Data

The data used were from the NYC Department of Health and Mental Hygiene annual restaurant inspections. Violations of health codes result in the restaurant being given a certain number of points, described below. While the data includes observations from 2012, we exclude them in our analysis because there was not data for each of the 5 boroughs. We include observations on each of the 5 boroughs from 2013 through 2017. Additionally, we exclude restaurants with a grade of NA, or anything that was not an A, B, or C. Some of the restaurants had inspections that were ongoing; these were excluded as well. 

Each violation falls into one of three categories:

A public health hazard, such as failing to store food at an appropriate temperature, results in a minimum score of 7

A critical violation, such as improperly washing raw vegetables prior to serving, results in a minimum score of 5

A general violation, such as improperly sanitizing cookware, results in a minimum score of 2


## Sample Code

The below code produces the plots for the _Dashboard_ tab above.

```{r}
library(tidyverse)
library(viridis)
library(p8105.datasets)
library(plotly)
data(rest_inspec)
```

```{r}
rest_clean = 
  mutate(rest_inspec, grade_date = as.character(grade_date)) %>% 
  separate(col = grade_date, into = c("year", "month", "day"), sep="-") %>% 
  select(-building, -camis, -street, -zipcode, -phone, -record_date, -violation_code) %>% 
  drop_na(grade, year) %>%
  filter(grade == "A" | grade == "B" | grade == "C", boro != "Missing", year != "2012")


rest_clean %>% 
  mutate(
    is_a = (grade == "A")
  ) %>% 
  group_by(boro, year) %>% 
  summarize(
    proportion_a = sum(is_a)/n()
  ) %>% plot_ly(x = ~year, y = ~proportion_a, type = "scatter", mode = "lines+markers",
    color = ~boro, alpha = 0.5)
```

```{r}
rest_clean %>% 
  group_by(grade, boro) %>% 
  summarize(
    n = n()
  ) %>% 
  plot_ly(x = ~boro, y = ~n, type = "bar",
          color = ~grade, alpha = 0.5)
```

```{r}
rest_clean %>% 
  plot_ly(x = ~boro, y = ~score, type = "violin")
```
